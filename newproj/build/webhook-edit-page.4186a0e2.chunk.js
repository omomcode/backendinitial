"use strict";(self.webpackChunknewproj=self.webpackChunknewproj||[]).push([[3881],{55627:(F,p,t)=>{t.d(p,{m:()=>S});var e=t(21272),f=t(80403),d=t(60256),v=t(74930);function S(){const{get:x}=(0,f.ry)(),{formatAPIError:R}=(0,f.wq)(),o=(0,f.hN)(),z=(0,v.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:u}}=await x("/content-manager/components");return u},onError(u){u instanceof d.pe&&o({type:"warning",message:R(u)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:u}}=await x("/content-manager/content-types");return u},onError(u){u instanceof d.pe&&o({type:"warning",message:R(u)})}}]),[K,D]=z,_=K.isLoading||D.isLoading,b=e.useMemo(()=>(D?.data??[]).filter(u=>u.kind==="collectionType"&&u.isDisplayed),[D?.data]),$=e.useMemo(()=>(D?.data??[]).filter(u=>u.kind!=="collectionType"&&u.isDisplayed),[D?.data]);return{isLoading:_,components:e.useMemo(()=>K?.data??[],[K?.data]),collectionTypes:b,singleTypes:$}}},67070:(F,p,t)=>{t.d(p,{A:()=>ie});var e=t(21272),f=t(46462),d=t(83997),v=t(8361),S=t(43064),x=t(66809),R=t(84843),o=t(81621),z=t(98765),K=t(30893),D=t(379),_=t(4181),b=t(50215),$=t(61535),u=t(33544),y=t.n(u),Y=t(54894),L=t(79793),de=t(55627);const h=s=>s.reduce((l,m)=>{const A=m.split(".")[0];return l[A]||(l[A]=[]),l[A].push(m),l},{}),H=(0,L.Ay)(f.X)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,re=s=>{const l=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(l.push({id:"app.utils.publish",defaultMessage:"Publish"}),l.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),l},ee=s=>{const l=["entry.create","entry.update","entry.delete"];return s&&l.push("entry.publish","entry.unpublish"),{entry:l,media:["media.create","media.update","media.delete"]}},te=e.createContext(),le=({children:s})=>{const{formatMessage:l}=(0,Y.A)(),{collectionTypes:m,isLoading:A}=(0,de.m)(),g=e.useMemo(()=>m.some(W=>W.options.draftAndPublish===!0),[m]),k=l({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(te.Provider,{value:{isDraftAndPublish:g}},e.createElement(d.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(v.d,{"aria-hidden":!0},k),A&&e.createElement(S.a,null,l({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(H,{"aria-label":k},s)))};le.propTypes={children:y().oneOfType([y().arrayOf(y().node),y().node]).isRequired};const ne=({getHeaders:s=re})=>{const{isDraftAndPublish:l}=e.useContext(te),{formatMessage:m}=(0,Y.A)(),A=s(l);return e.createElement(x.r,null,e.createElement(R.N,null,e.createElement(o.e,null,e.createElement(z.s,null,m({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),A.map(g=>["app.utils.publish","app.utils.unpublish"].includes(g.id)?e.createElement(o.e,{key:g.id,title:m({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(K.o,{variant:"sigma",textColor:"neutral600"},m(g))):e.createElement(o.e,{key:g.id},e.createElement(K.o,{variant:"sigma",textColor:"neutral600"},m(g))))))};ne.defaultProps={getHeaders:re},ne.propTypes={getHeaders:y().func};const se=({providedEvents:s})=>{const{isDraftAndPublish:l}=e.useContext(te),m=s||ee(l),{values:A,handleChange:g}=(0,$.j7)(),k="events",W=A.events,J=[],V=h(W),j=({target:{name:P,value:E}})=>{let I=new Set(W);E?I.add(P):I.delete(P),g({target:{name:k,value:Array.from(I)}})},Q=({target:{name:P,value:E}})=>{let I=new Set(W);E?m[P].forEach(O=>{J.includes(O)||I.add(O)}):m[P].forEach(O=>I.delete(O)),g({target:{name:k,value:Array.from(I)}})};return e.createElement(D.f,null,Object.entries(m).map(([P,E])=>e.createElement(Z,{disabledEvents:J,key:P,name:P,events:E,inputValue:V[P],handleSelect:j,handleSelectAll:Q})))};se.defaultProps={providedEvents:null},se.propTypes={providedEvents:y().object};const ce=s=>s.replace(/-/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "),Z=({disabledEvents:s,name:l,events:m,inputValue:A,handleSelect:g,handleSelectAll:k})=>{const{formatMessage:W}=(0,Y.A)(),J=m.filter(E=>!s.includes(E)),V=A.length>0,j=A.length===J.length,Q=({target:{name:E}})=>{k({target:{name:E,value:!j}})},P=5;return e.createElement(R.N,null,e.createElement(o.N,null,e.createElement(_.S,{indeterminate:V&&!j,"aria-label":W({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:l,onChange:Q,value:j},ce(l))),m.map(E=>e.createElement(o.N,{key:E},e.createElement(b.J,{disabled:s.includes(E),"aria-label":E,name:E,value:A.includes(E),onValueChange:I=>g({target:{name:E,value:I}})}))),m.length<P&&e.createElement(o.N,{colSpan:P-m.length}))};Z.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},Z.propTypes={disabledEvents:y().array,events:y().array,inputValue:y().array,handleSelect:y().func,handleSelectAll:y().func,name:y().string.isRequired};const ie={Root:le,Headers:ne,Body:se,EventRow:Z}},45944:(F,p,t)=>{t.d(p,{A:()=>fe});var e=t(21272),f=t(38413),d=t(80403),v=t(74930),S=t(17703),x=t(55627),R=t(55356),o=t(83997),z=t(85963),K=t(4198),D=t(94061),_=t(90151),b=t(68074),$=t(7537),u=t(98052),y=t(54514),Y=t(46270),L=t(61535),de=t(33544),h=t.n(de),H=t(54894),re=t(88022),ee=t(67070);function te(){return e.createElement(ee.A.Root,null,e.createElement(ee.A.Headers,null),e.createElement(ee.A.Body,null))}var le=t(8361),ne=t(18629),se=t(5194),ce=t(76517),Z=t(80782);const ie=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],s=({name:n,onChange:a,value:r,...c})=>{const{values:{headers:M}}=(0,L.j7)(),[T,i]=(0,e.useState)(ie);(0,e.useEffect)(()=>{i(ie.filter(C=>!M?.some(N=>N.key!==r&&N.key===C)))},[M,r]);const X=C=>{a({target:{name:n,value:C}})},q=C=>{i(N=>[...N,C]),X(C)};return e.createElement(ce.nP,{...c,onClear:()=>X(""),onChange:X,onCreateOption:q,placeholder:"",value:r},T.map(C=>e.createElement(Z.j,{value:C,key:C},C)))};s.defaultProps={value:void 0},s.propTypes={name:h().string.isRequired,onChange:h().func.isRequired,value:h().string};const l=s,A=()=>{const{formatMessage:n}=(0,H.A)(),{values:a,errors:r}=(0,L.j7)();return e.createElement(o.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(le.d,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(D.a,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(L.ED,{validateOnChange:!1,name:"headers",render:({push:c,remove:M})=>e.createElement(_.x,{gap:4},a.headers.map((T,i)=>e.createElement(e.Fragment,{key:`${i}.${T.key}`},e.createElement(b.E,{col:6},e.createElement(L.D0,{as:l,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:r.headers?.[i]?.key&&r.headers[i].key})),e.createElement(b.E,{col:6},e.createElement(o.s,{alignItems:"flex-end"},e.createElement(D.a,{style:{flex:1}},e.createElement(L.D0,{as:$.k,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:r.headers?.[i]?.value&&r.headers[i].value})),e.createElement(o.s,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:r.headers?.[i]?.value?0:5},e.createElement(d.yX,{disabled:a.headers.length===1,onClick:()=>M(i),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})))))),e.createElement(b.E,{col:12},e.createElement(ne.Q,{type:"button",onClick:()=>{c({key:"",value:""})},startIcon:e.createElement(se.A,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var g=t(30893),k=t(84795),W=t(68802),J=t(79793);const V=J.Ay.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),j=({isPending:n,statusCode:a})=>{const{formatMessage:r}=(0,H.A)();return n?e.createElement(o.s,{gap:2,alignItems:"center"},e.createElement(V,{as:k.A}),e.createElement(g.o,null,r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(o.s,{gap:2,alignItems:"center"},e.createElement(V,{as:y.A,color:"success700"}),e.createElement(g.o,null,r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(o.s,{gap:2,alignItems:"center"},e.createElement(V,{as:W.A,color:"danger700"}),e.createElement(g.o,null,r({id:"Settings.error",defaultMessage:"error"})," ",a)):null};j.propTypes={isPending:h().bool.isRequired,statusCode:h().number},j.defaultProps={statusCode:void 0};const Q=({statusCode:n,message:a})=>{const{formatMessage:r}=(0,H.A)();return n>=200&&n<300?e.createElement(o.s,{justifyContent:"flex-end"},e.createElement(g.o,{textColor:"neutral600",ellipsis:!0},r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(o.s,{justifyContent:"flex-end"},e.createElement(o.s,{maxWidth:(0,d.a8)(250),justifyContent:"flex-end",title:a},e.createElement(g.o,{ellipsis:!0,textColor:"neutral600"},a))):null};Q.propTypes={statusCode:h().number,message:h().string},Q.defaultProps={statusCode:void 0,message:void 0};const P=({onCancel:n})=>{const{formatMessage:a}=(0,H.A)();return e.createElement(o.s,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(o.s,{gap:2,alignItems:"center"},e.createElement(g.o,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(V,{as:W.A,color:"neutral400"}))))};P.propTypes={onCancel:h().func.isRequired};const E=({isPending:n,onCancel:a,response:r})=>{const{statusCode:c,message:M}=r,{formatMessage:T}=(0,H.A)();return e.createElement(D.a,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(_.x,{gap:4,style:{alignItems:"center"}},e.createElement(b.E,{col:3},e.createElement(g.o,null,T({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(b.E,{col:3},e.createElement(j,{isPending:n,statusCode:c})),e.createElement(b.E,{col:6},n?e.createElement(P,{onCancel:a}):e.createElement(Q,{statusCode:c,message:M}))))};E.defaultProps={isPending:!1,onCancel(){},response:{}},E.propTypes={isPending:h().bool,onCancel:h().func,response:h().object};const I=E;var O=t(12083);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:n})=>O.Ik().shape({name:O.Yj().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:O.Yj().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:O.RZ(a=>{let r=O.YO();if(a.length===1){const{key:c,value:M}=a[0];if(!c&&!M)return r}return r.of(O.Ik().shape({key:O.Yj().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:O.Yj().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:O.YO()}),ue=({handleSubmit:n,triggerWebhook:a,isCreating:r,isTriggering:c,triggerResponse:M,data:T})=>{const{formatMessage:i}=(0,H.A)(),[X,q]=(0,e.useState)(!1),C=(0,re.h)(te,async()=>(await t.e(2785).then(t.bind(t,7547))).EventTableEE),N=w=>Object.keys(w).length?Object.entries(w).map(([ae,oe])=>({key:ae,value:oe})):[{key:"",value:""}],B=(0,L.Wx)({initialValues:{name:T?.name||"",url:T?.url||"",headers:N(T?.headers||{}),events:T?.events||[]},onSubmit(w,{resetForm:ae,setSubmitting:oe}){n(w),ae({values:w}),oe(!1)},validationSchema:he({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return C?e.createElement(L.QI,{value:B},e.createElement(d.lV,{onSubmit:B.handleSubmit},e.createElement(R.Q,{primaryAction:e.createElement(o.s,{gap:2},e.createElement(z.$,{onClick:()=>{a(),q(!0)},variant:"tertiary",startIcon:e.createElement(u.A,null),disabled:r||c,size:"L"},i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(z.$,{startIcon:e.createElement(y.A,null),type:"submit",size:"L",disabled:!B.dirty,loading:B.isSubmitting},i({id:"global.save",defaultMessage:"Save"}))),title:r?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):T?.name,navigationAction:e.createElement(d.N_,{startIcon:e.createElement(Y.A,null),to:"/settings/webhooks"},i({id:"global.back",defaultMessage:"Back"}))}),e.createElement(K.s,null,e.createElement(o.s,{direction:"column",alignItems:"stretch",gap:4},X&&e.createElement(I,{isPending:c,response:M,onCancel:()=>q(!1)}),e.createElement(D.a,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(o.s,{direction:"column",alignItems:"stretch",gap:6},e.createElement(_.x,{gap:6},e.createElement(b.E,{col:6},e.createElement(L.D0,{as:$.k,name:"name",error:B?.errors?.name&&B.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(b.E,{col:12},e.createElement(L.D0,{as:$.k,name:"url",error:B?.errors?.url&&B.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(A,null),e.createElement(C,null))))))):null};ue.propTypes={data:h().object,handleSubmit:h().func.isRequired,triggerWebhook:h().func.isRequired,isCreating:h().bool.isRequired,isTriggering:h().bool.isRequired,triggerResponse:h().object},ue.defaultProps={data:void 0,triggerResponse:void 0};const pe=ue,me=n=>({...n,headers:n.headers.reduce((a,{key:r,value:c})=>(r!==""&&(a[r]=c),a),{})}),fe=()=>{const{params:{id:n}}=(0,S.W5)("/settings/webhooks/:id"),a=n==="create",{replace:r}=(0,S.W6)(),c=(0,d.hN)(),{formatAPIError:M}=(0,d.wq)(),T=(0,v.useQueryClient)(),{isLoading:i}=(0,x.m)(),{put:X,get:q,post:C}=(0,d.ry)(),{isLoading:N,data:B,error:w}=(0,v.useQuery)(["webhooks",n],async()=>{const{data:{data:U}}=await q(`/admin/webhooks/${n}`);return U},{enabled:!a});e.useEffect(()=>{w&&c({type:"warning",message:M(w)})},[w,c,M]);const{isLoading:ae,data:oe,isIdle:ve,mutate:ye}=(0,v.useMutation)(()=>C(`/admin/webhooks/${n}/trigger`)),Me=()=>ye(null,{onError(U){c({type:"warning",message:M(U)})}}),Ce=(0,v.useMutation)(U=>C("/admin/webhooks",U)),Ae=(0,v.useMutation)(({id:U,body:G})=>X(`/admin/webhooks/${U}`,G)),Pe=async U=>{if(a){Ce.mutate(me(U),{onSuccess({data:G}){c({type:"success",message:{id:"Settings.webhooks.created"}}),r(`/settings/webhooks/${G.data.id}`)},onError(G){c({type:"warning",message:M(G)})}});return}Ae.mutate({id:n,body:me(U)},{onSuccess(){T.invalidateQueries(["webhooks",n]),c({type:"success",message:{id:"notification.form.success.fields"}})},onError(G){c({type:"warning",message:M(G)})}})};return N||i?e.createElement(d.Bl,null):e.createElement(f.g,null,e.createElement(d.x7,{name:"Webhooks"}),e.createElement(pe,{data:B,handleSubmit:Pe,triggerWebhook:Me,isCreating:a,isTriggering:ae,isTriggerIdle:ve,triggerResponse:oe?.data.data}))}},31479:(F,p,t)=>{t.r(p),t.d(p,{default:()=>R});var e=t(21272),f=t(80403),d=t(82437),v=t(71526),S=t(45944);const R=()=>{const o=(0,d.d4)(v.G);return e.createElement(f.kz,{permissions:o.settings.webhooks.create},e.createElement(S.A,null))}},83807:(F,p,t)=>{t.r(p),t.d(p,{default:()=>R});var e=t(21272),f=t(80403),d=t(82437),v=t(71526),S=t(45944);const R=()=>{const o=(0,d.d4)(v.G);return e.createElement(f.kz,{permissions:o.settings.webhooks.update},e.createElement(S.A,null))}},80782:(F,p,t)=>{t.d(p,{j:()=>f});var e=t(76517);const f=e.c$},46270:(F,p,t)=>{t.d(p,{A:()=>d});var e=t(92132);const f=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),d=f},60256:(F,p,t)=>{t.d(p,{pe:()=>d});var e=t(41629);const{Axios:f,AxiosError:d,CanceledError:v,isCancel:S,CancelToken:x,VERSION:R,all:o,Cancel:z,isAxiosError:K,spread:D,toFormData:_,AxiosHeaders:b,HttpStatusCode:$,formToJSON:u,getAdapter:y,mergeConfig:Y}=e.A}}]);
